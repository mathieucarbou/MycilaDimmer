<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MycilaJSY: MycilaDimmer</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">MycilaJSY<span id="projectnumber">&#160;13.0.0</span>
   </div>
   <div id="projectbrief">Arduino / ESP32 library for the JSY1031, JSY-MK-163, JSY-MK-193, JSY-MK-194, JSY-MK-227, JSY-MK-229, JSY-MK-333 families single-phase and three-phase AC bidirectional meters from Shenzhen Jiansiyan Technologies Co, Ltd.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">MycilaDimmer </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__r_e_a_d_m_e"></a></p>
<p><a href="https://opensource.org/licenses/MIT"><img src="https://img.shields.io/badge/License-MIT-yellow.svg" alt="License: MIT" style="pointer-events: none;" class="inline"/></a> <a href="https://github.com/mathieucarbou/MycilaDimmer/actions/workflows/ci.yml"><img src="https://github.com/mathieucarbou/MycilaDimmer/actions/workflows/ci.yml/badge.svg" alt="Continuous Integration" style="pointer-events: none;" class="inline"/></a> <a href="https://registry.platformio.org/libraries/mathieucarbou/MycilaDimmer"><img src="https://badges.registry.platformio.org/packages/mathieucarbou/library/MycilaDimmer.svg" alt="PlatformIO Registry" style="pointer-events: none;" class="inline"/></a></p>
<p>A comprehensive ESP32/Arduino library for controlling AC power devices including TRIACs, SSRs, and voltage regulators through multiple dimming methods.</p>
<p><img src="https://mathieu.carbou.me/MycilaDimmer/assets/img/console.png" alt="" class="inline"/> <img src="https://mathieu.carbou.me/MycilaDimmer/assets/img/anim.gif" alt="" class="inline"/></p>
<h1>Table of Contents</h1>
<ul>
<li>Overview</li>
<li>Features</li>
<li>Hardware Support<ul>
<li>Supported Platforms</li>
<li>Supported Hardware</li>
</ul>
</li>
<li>Installation<ul>
<li>PlatformIO</li>
<li>Arduino IDE</li>
</ul>
</li>
<li>Quick Start</li>
<li>Dimmer Types<ul>
<li>Thyristor Dimmer</li>
<li>PWM Dimmer</li>
<li>DFRobot DAC Dimmer</li>
</ul>
</li>
<li>Understanding AC Dimming Methods<ul>
<li>Dimming Method Comparison<ul>
<li>Phase Control</li>
<li>Burst Fire on Full Period</li>
<li>Burst Fire on Semi-Period</li>
<li>Stochastic Burst Fire (Coming Soon)</li>
</ul>
</li>
<li>Recommendations for Harmonic Mitigation (Phase Control)</li>
<li>Current MycilaDimmer Support</li>
<li>Choosing the Right Method</li>
</ul>
</li>
<li>References and Further Reading</li>
<li>API Reference<ul>
<li>Common API (All Dimmer Types)</li>
<li>Thyristor Dimmer Specific</li>
<li>PWM Dimmer Specific</li>
<li>DFRobot DAC Dimmer Specific</li>
<li>Advanced Features</li>
</ul>
</li>
<li>Configuration<ul>
<li>Build Flags</li>
</ul>
</li>
<li>Examples</li>
<li>Build Configuration<ul>
<li>PlatformIO Configuration</li>
<li>Dependencies</li>
</ul>
</li>
<li>Troubleshooting<ul>
<li>Common Issues</li>
</ul>
</li>
<li>Contributing<ul>
<li>Development Setup</li>
</ul>
</li>
<li>License</li>
<li>Disclaimer</li>
</ul>
<h1>Overview</h1>
<p>MycilaDimmer provides a unified interface for controlling AC power devices through different hardware implementations. The library uses a polymorphic architecture that allows you to switch between different dimming methods without changing your application code.</p>
<p><b>Key Benefits:</b></p>
<ul>
<li><b>Unified API</b> - Same interface for all dimmer types</li>
<li><b>IRAM Safe</b> - Interrupt handlers work during flash operations</li>
<li><b>Hardware Agnostic</b> - Supports multiple hardware approaches</li>
<li><b>Production Ready</b> - Used in <a href="https://yasolr.carbou.me">YaSolR</a> Solar Router</li>
</ul>
<h1>Features</h1>
<ul>
<li>‚ú® <b>Flicker-Free Dimming</b>: Progressive dimming without flickering using precise DAC control or zero-cross detection with quality ZCD circuits</li>
<li>üéõÔ∏è <b>Multiple Control Methods</b>: Zero-cross detection, PWM, and I2C DAC</li>
<li>‚ö° <b>High Performance</b>: IRAM-safe interrupt handlers with lookup table optimization</li>
<li>üí° <b>Selectable Dimming Curves</b>: Choose between linear dimming or Power LUT for perceptual brightness matching - switch at runtime based on your needs</li>
<li>ÔøΩ <b>Flexible Configuration</b>: Duty cycle remapping, calibration, and user-selectable dimming modes</li>
<li>üìä <b>Rich Telemetry</b>: Duty cycle measurements, firing ratios, and online status</li>
<li>üõ°Ô∏è <b>Safety Features</b>: Duty cycle limits and grid connection detection</li>
<li>üì± <b>JSON Integration</b>: Optional ArduinoJson support for telemetry</li>
<li>üîÑ <b>Real-time Control</b>: Microsecond-precision timing control</li>
</ul>
<h1>Hardware Support</h1>
<h2>Supported Platforms</h2>
<ul>
<li><b>ESP32</b> (all variants: ESP32, ESP32-S2, ESP32-S3, ESP32-C3, ESP32-C6, ESP32-H2)</li>
<li><b>Arduino Framework</b> via PlatformIO or Arduino IDE</li>
</ul>
<h2>Supported Hardware</h2>
<ul>
<li><b>TRIACs</b> with zero-cross detection circuits</li>
<li><b>Random Solid State Relays (SSRs)</b></li>
<li><b>Voltage Regulators</b> with 0-10V control (LSA, LCTC, etc)</li>
<li><b>DFRobot DAC Modules</b> (GP8211S, GP8413, GP8403)</li>
</ul>
<h1>Installation</h1>
<h2>PlatformIO</h2>
<div class="fragment"><div class="line">[env:myproject]</div>
<div class="line">lib_deps =</div>
<div class="line">    mathieucarbou/MycilaDimmer</div>
</div><!-- fragment --><h2>Arduino IDE</h2>
<ol type="1">
<li>Go to <b>Sketch</b> ‚Üí <b>Include Library</b> ‚Üí <b>Manage Libraries</b></li>
<li>Search for "MycilaDimmer"</li>
<li>Install the library by Mathieu Carbou</li>
</ol>
<h1>Quick Start</h1>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;MycilaDimmer.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create a PWM dimmer instance</span></div>
<div class="line"><a class="code hl_class" href="class_mycila_1_1_p_w_m_dimmer.html">Mycila::PWMDimmer</a> dimmer;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup() {</div>
<div class="line">  Serial.<a class="code hl_function" href="class_mycila_1_1_p_w_m_dimmer.html#a7544d46c5613d21168eae14807fb9cde">begin</a>(115200);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Configure the dimmer</span></div>
<div class="line">  dimmer.<a class="code hl_function" href="class_mycila_1_1_p_w_m_dimmer.html#a04eda47bd3b808743674eb3fc034aac7">setPin</a>(GPIO_NUM_26);</div>
<div class="line">  dimmer.<a class="code hl_function" href="class_mycila_1_1_p_w_m_dimmer.html#a7544d46c5613d21168eae14807fb9cde">begin</a>();</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Set 50% power</span></div>
<div class="line">  dimmer.<a class="code hl_function" href="class_mycila_1_1_dimmer.html#aa159163ef95c8edd6e54b345e09b3d43">setDutyCycle</a>(0.5);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop() {</div>
<div class="line">  <span class="comment">// Gradually increase power</span></div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">float</span> power = 0.0; power &lt;= 1.0; power += 0.1) {</div>
<div class="line">    dimmer.<a class="code hl_function" href="class_mycila_1_1_dimmer.html#aa159163ef95c8edd6e54b345e09b3d43">setDutyCycle</a>(power);</div>
<div class="line">    delay(1000);</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="ttc" id="aclass_mycila_1_1_dimmer_html_aa159163ef95c8edd6e54b345e09b3d43"><div class="ttname"><a href="class_mycila_1_1_dimmer.html#aa159163ef95c8edd6e54b345e09b3d43">Mycila::Dimmer::setDutyCycle</a></div><div class="ttdeci">bool setDutyCycle(float dutyCycle)</div><div class="ttdoc">Set the power duty.</div><div class="ttdef"><b>Definition</b> <a href="_mycila_dimmer_8h_source.html#l00188">MycilaDimmer.h:188</a></div></div>
<div class="ttc" id="aclass_mycila_1_1_p_w_m_dimmer_html"><div class="ttname"><a href="class_mycila_1_1_p_w_m_dimmer.html">Mycila::PWMDimmer</a></div><div class="ttdef"><b>Definition</b> <a href="_mycila_dimmer_p_w_m_8h_source.html#l00013">MycilaDimmerPWM.h:13</a></div></div>
<div class="ttc" id="aclass_mycila_1_1_p_w_m_dimmer_html_a04eda47bd3b808743674eb3fc034aac7"><div class="ttname"><a href="class_mycila_1_1_p_w_m_dimmer.html#a04eda47bd3b808743674eb3fc034aac7">Mycila::PWMDimmer::setPin</a></div><div class="ttdeci">void setPin(gpio_num_t pin)</div><div class="ttdoc">Set the GPIO pin to use for the dimmer.</div><div class="ttdef"><b>Definition</b> <a href="_mycila_dimmer_p_w_m_8h_source.html#l00020">MycilaDimmerPWM.h:20</a></div></div>
<div class="ttc" id="aclass_mycila_1_1_p_w_m_dimmer_html_a7544d46c5613d21168eae14807fb9cde"><div class="ttname"><a href="class_mycila_1_1_p_w_m_dimmer.html#a7544d46c5613d21168eae14807fb9cde">Mycila::PWMDimmer::begin</a></div><div class="ttdeci">virtual void begin()</div><div class="ttdoc">Enable a dimmer on a specific GPIO pin.</div><div class="ttdef"><b>Definition</b> <a href="_mycila_dimmer_p_w_m_8cpp_source.html#l00038">MycilaDimmerPWM.cpp:38</a></div></div>
</div><!-- fragment --><h1>Dimmer Types</h1>
<h2>Thyristor Dimmer</h2>
<p>Perfect for TRIAC and Random SSR control with <b>flicker-free progressive dimming</b>. Achieves smooth, continuous power control through precise phase angle control when paired with quality zero-cross detection circuits.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;MycilaDimmer.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="class_mycila_1_1_thyristor_dimmer.html">Mycila::ThyristorDimmer</a> dimmer;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup() {</div>
<div class="line">  dimmer.<a class="code hl_function" href="class_mycila_1_1_thyristor_dimmer.html#a6ea7401605120ef604f0f5fdb255b58e">setPin</a>(GPIO_NUM_26);</div>
<div class="line">  dimmer.<a class="code hl_function" href="class_mycila_1_1_thyristor_dimmer.html#aaf06ed2c2bc8e2ab9e103f928b623a35">setSemiPeriod</a>(10000); <span class="comment">// 50Hz AC (10ms semi-period)</span></div>
<div class="line">  dimmer.<a class="code hl_function" href="class_mycila_1_1_thyristor_dimmer.html#ac49a5479c2f74f67078a2ebf9656e004">begin</a>();</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Register with external zero-cross detector</span></div>
<div class="line">  pulseAnalyzer.onZeroCross(<a class="code hl_function" href="class_mycila_1_1_thyristor_dimmer.html#a5b09bdb65f3ee8676ecaf31290d24d6c">Mycila::ThyristorDimmer::onZeroCross</a>);</div>
<div class="line">}</div>
<div class="ttc" id="aclass_mycila_1_1_thyristor_dimmer_html"><div class="ttname"><a href="class_mycila_1_1_thyristor_dimmer.html">Mycila::ThyristorDimmer</a></div><div class="ttdef"><b>Definition</b> <a href="_mycila_dimmer_thyristor_8h_source.html#l00011">MycilaDimmerThyristor.h:11</a></div></div>
<div class="ttc" id="aclass_mycila_1_1_thyristor_dimmer_html_a5b09bdb65f3ee8676ecaf31290d24d6c"><div class="ttname"><a href="class_mycila_1_1_thyristor_dimmer.html#a5b09bdb65f3ee8676ecaf31290d24d6c">Mycila::ThyristorDimmer::onZeroCross</a></div><div class="ttdeci">static void onZeroCross(int16_t delayUntilZero, void *args)</div><div class="ttdef"><b>Definition</b> <a href="_mycila_dimmer_thyristor_8cpp_source.html#l00101">MycilaDimmerThyristor.cpp:101</a></div></div>
<div class="ttc" id="aclass_mycila_1_1_thyristor_dimmer_html_a6ea7401605120ef604f0f5fdb255b58e"><div class="ttname"><a href="class_mycila_1_1_thyristor_dimmer.html#a6ea7401605120ef604f0f5fdb255b58e">Mycila::ThyristorDimmer::setPin</a></div><div class="ttdeci">void setPin(gpio_num_t pin)</div><div class="ttdoc">Set the GPIO pin to use for the dimmer.</div><div class="ttdef"><b>Definition</b> <a href="_mycila_dimmer_thyristor_8h_source.html#l00018">MycilaDimmerThyristor.h:18</a></div></div>
<div class="ttc" id="aclass_mycila_1_1_thyristor_dimmer_html_aaf06ed2c2bc8e2ab9e103f928b623a35"><div class="ttname"><a href="class_mycila_1_1_thyristor_dimmer.html#aaf06ed2c2bc8e2ab9e103f928b623a35">Mycila::ThyristorDimmer::setSemiPeriod</a></div><div class="ttdeci">void setSemiPeriod(uint16_t semiPeriod)</div><div class="ttdoc">Set the semi-period of the grid frequency in us. It cannot be zero and it is required for proper dimm...</div><div class="ttdef"><b>Definition</b> <a href="_mycila_dimmer_thyristor_8h_source.html#l00028">MycilaDimmerThyristor.h:28</a></div></div>
<div class="ttc" id="aclass_mycila_1_1_thyristor_dimmer_html_ac49a5479c2f74f67078a2ebf9656e004"><div class="ttname"><a href="class_mycila_1_1_thyristor_dimmer.html#ac49a5479c2f74f67078a2ebf9656e004">Mycila::ThyristorDimmer::begin</a></div><div class="ttdeci">virtual void begin()</div><div class="ttdoc">Enable a dimmer on a specific GPIO pin.</div><div class="ttdef"><b>Definition</b> <a href="_mycila_dimmer_thyristor_8cpp_source.html#l00070">MycilaDimmerThyristor.cpp:70</a></div></div>
</div><!-- fragment --><p><b>Features:</b></p>
<ul>
<li><b>Flicker-free dimming</b>: Smooth progressive control without visible flickering</li>
<li>Microsecond-precision phase angle control</li>
<li>Lookup table with linear interpolation for seamless transitions</li>
<li>IRAM-safe interrupt handlers</li>
<li>Supports several zero-cross detection circuits:<ul>
<li><a href="https://www.pcbway.com/project/shareproject/Zero_Cross_Detector_a707a878.html">Zero-Cross Detector</a> from Daniel S</li>
<li><a href="https://www.jsypowermeter.com/jsy-mk-194g-ac-single-phase-bidirectional-power-energy-meter-module-with-2-split-core-cts-product/">JSY-MK-194G</a></li>
<li>RobotDyn ZCD</li>
<li>BM1Z102FJ</li>
<li>Any other ZCD circuit providing a clean digital pulse at each zero-crossing</li>
</ul>
</li>
</ul>
<p>The Zero-Cross Detector mounted on DIN Rail mount from Daniel is is very good and reliable. I sometimes buy it in bulk from PCBWay. If you want one, you can have a look at the <a href="https://yasolr.carbou.me/pro#available-hardware">YaSolR Pro page</a> for the stock status.</p>
<h2>PWM Dimmer</h2>
<p>Standard PWM output for SSRs and other PWM-controlled devices.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;MycilaDimmer.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="class_mycila_1_1_p_w_m_dimmer.html">Mycila::PWMDimmer</a> dimmer;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup() {</div>
<div class="line">  dimmer.<a class="code hl_function" href="class_mycila_1_1_p_w_m_dimmer.html#a04eda47bd3b808743674eb3fc034aac7">setPin</a>(GPIO_NUM_26);</div>
<div class="line">  dimmer.<a class="code hl_function" href="class_mycila_1_1_p_w_m_dimmer.html#a4de79584bffb1a77bba14a97e6c22d81">setFrequency</a>(1000);  <span class="comment">// 1kHz PWM</span></div>
<div class="line">  dimmer.<a class="code hl_function" href="class_mycila_1_1_p_w_m_dimmer.html#a1e03df6c8414c708adfb214ec9135e7c">setResolution</a>(12);   <span class="comment">// 12-bit resolution</span></div>
<div class="line">  dimmer.<a class="code hl_function" href="class_mycila_1_1_p_w_m_dimmer.html#a7544d46c5613d21168eae14807fb9cde">begin</a>();</div>
<div class="line">}</div>
<div class="ttc" id="aclass_mycila_1_1_p_w_m_dimmer_html_a1e03df6c8414c708adfb214ec9135e7c"><div class="ttname"><a href="class_mycila_1_1_p_w_m_dimmer.html#a1e03df6c8414c708adfb214ec9135e7c">Mycila::PWMDimmer::setResolution</a></div><div class="ttdeci">void setResolution(uint8_t resolution)</div><div class="ttdoc">Set the PWM resolution in bits.</div><div class="ttdef"><b>Definition</b> <a href="_mycila_dimmer_p_w_m_8h_source.html#l00040">MycilaDimmerPWM.h:40</a></div></div>
<div class="ttc" id="aclass_mycila_1_1_p_w_m_dimmer_html_a4de79584bffb1a77bba14a97e6c22d81"><div class="ttname"><a href="class_mycila_1_1_p_w_m_dimmer.html#a4de79584bffb1a77bba14a97e6c22d81">Mycila::PWMDimmer::setFrequency</a></div><div class="ttdeci">void setFrequency(uint32_t frequency)</div><div class="ttdoc">Set the PWM frequency in Hz.</div><div class="ttdef"><b>Definition</b> <a href="_mycila_dimmer_p_w_m_8h_source.html#l00030">MycilaDimmerPWM.h:30</a></div></div>
</div><!-- fragment --><p><b>Features:</b></p>
<ul>
<li>Configurable frequency (default: 1kHz)</li>
<li>Configurable resolution (default: 12-bit)</li>
<li>Automatic PWM channel management</li>
</ul>
<p>For example, this dimmer can be used with a <a href="https://aliexpress.com/item/1005004859012736.html">3.3V to 0-5V/0-10V signal converter</a></p>
<h2>DFRobot DAC Dimmer</h2>
<p><b>Flicker-free progressive dimming</b> using precision I2C DAC modules. Perfect for voltage regulator controlled devices (<a href="https://aliexpress.com/item/32606780994.html">LSA</a>, <a href="https://aliexpress.com/item/1005005008018888.html">LCTC</a>, etc) with 0-10V input, providing ultra-smooth dimming without any visible flickering thanks to high-resolution DAC output.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;MycilaDimmer.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="class_mycila_1_1_d_f_robot_dimmer.html">Mycila::DFRobotDimmer</a> dimmer;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup() {</div>
<div class="line">  dimmer.setSKU(Mycila::DFRobotDimmer::SKU::DFR1071_GP8211S);</div>
<div class="line">  dimmer.<a class="code hl_function" href="class_mycila_1_1_d_f_robot_dimmer.html#a0bbc67b4737e18c386b6b28a2ba5c0c0">setDeviceAddress</a>(0x59);</div>
<div class="line">  dimmer.<a class="code hl_function" href="class_mycila_1_1_d_f_robot_dimmer.html#a787206839fe862de890da60eb49db146">setOutput</a>(Mycila::DFRobotDimmer::Output::RANGE_0_10V);</div>
<div class="line">  dimmer.<a class="code hl_function" href="class_mycila_1_1_d_f_robot_dimmer.html#aee505bd9c8c5446e57be20d2d04f96cb">begin</a>();</div>
<div class="line">}</div>
<div class="ttc" id="aclass_mycila_1_1_d_f_robot_dimmer_html"><div class="ttname"><a href="class_mycila_1_1_d_f_robot_dimmer.html">Mycila::DFRobotDimmer</a></div><div class="ttdef"><b>Definition</b> <a href="_mycila_dimmer_d_f_robot_8h_source.html#l00012">MycilaDimmerDFRobot.h:12</a></div></div>
<div class="ttc" id="aclass_mycila_1_1_d_f_robot_dimmer_html_a0bbc67b4737e18c386b6b28a2ba5c0c0"><div class="ttname"><a href="class_mycila_1_1_d_f_robot_dimmer.html#a0bbc67b4737e18c386b6b28a2ba5c0c0">Mycila::DFRobotDimmer::setDeviceAddress</a></div><div class="ttdeci">void setDeviceAddress(uint8_t deviceAddress)</div><div class="ttdoc">I2C address of the device.</div><div class="ttdef"><b>Definition</b> <a href="_mycila_dimmer_d_f_robot_8h_source.html#l00048">MycilaDimmerDFRobot.h:48</a></div></div>
<div class="ttc" id="aclass_mycila_1_1_d_f_robot_dimmer_html_a787206839fe862de890da60eb49db146"><div class="ttname"><a href="class_mycila_1_1_d_f_robot_dimmer.html#a787206839fe862de890da60eb49db146">Mycila::DFRobotDimmer::setOutput</a></div><div class="ttdeci">void setOutput(Output output)</div><div class="ttdoc">Set output mode of the device: 0-5V or 0-10V.</div><div class="ttdef"><b>Definition</b> <a href="_mycila_dimmer_d_f_robot_8h_source.html#l00041">MycilaDimmerDFRobot.h:41</a></div></div>
<div class="ttc" id="aclass_mycila_1_1_d_f_robot_dimmer_html_aee505bd9c8c5446e57be20d2d04f96cb"><div class="ttname"><a href="class_mycila_1_1_d_f_robot_dimmer.html#aee505bd9c8c5446e57be20d2d04f96cb">Mycila::DFRobotDimmer::begin</a></div><div class="ttdeci">virtual void begin()</div><div class="ttdoc">Enable a dimmer on a specific GPIO pin.</div><div class="ttdef"><b>Definition</b> <a href="_mycila_dimmer_d_f_robot_8cpp_source.html#l00026">MycilaDimmerDFRobot.cpp:26</a></div></div>
</div><!-- fragment --><p><b>Supported Models:</b></p>
<ul>
<li><b><a href="https://www.dfrobot.com/product-2613.html">DFR0971</a> (GP8403)</b>: 12-bit, dual channel, 0-5V/10V</li>
<li><b><a href="https://www.dfrobot.com/product-2757.html">DFR1071</a> (GP8211S)</b>: 15-bit, single channel, 0-5V/10V</li>
<li><b><a href="https://www.dfrobot.com/product-2756.html">DFR1073</a> (GP8413)</b>: 15-bit, dual channel, 0-5V/10V</li>
</ul>
<p>Here is a <a href="https://www.dfrobot.com/blog-13458.html">comparison table</a> of the different DFRobot DAC modules.</p>
<h1>Understanding AC Dimming Methods</h1>
<p>When controlling AC power devices like TRIACs, SSRs, and voltage regulators, there are several dimming approaches available. Each method has specific characteristics, advantages, and limitations that affect precision, grid compatibility, and regulatory compliance.</p>
<h2>Dimming Method Comparison</h2>
<h3>Phase Control</h3>
<p><b>How it works:</b> Controls power by delaying the firing angle within each AC semi-period (twice per cycle). The TRIAC/SSR activates at a specific point in the sine wave, "chopping" the waveform to deliver partial power.</p>
<p><img src="https://mathieu.carbou.me/MycilaDimmer/assets/img/measurements/Oscillo_Dimmer_50.jpeg" alt="" class="inline"/></p>
<p><b>Advantages:</b></p>
<ul>
<li>‚úÖ <b>High Precision</b>: Can adjust power at each semi-period (every 10ms for 50Hz), enabling watt-level control</li>
<li>‚úÖ <b>Fast Response</b>: Instant power adjustment with no delay</li>
<li>‚úÖ <b>Accurate Power Control</b>: With Power LUT, achieves predictable power output matching the desired level</li>
<li>‚úÖ <b>Regulatory Compliant</b>: Keeps grid balanced (no DC component) when properly implemented under harmonic regulations</li>
<li>‚úÖ <b>Widely Used</b>: Standard method in commercial dimmers and variable speed drives</li>
</ul>
<p><b>Limitations:</b></p>
<ul>
<li>‚ö†Ô∏è <b>Harmonics</b>: Generates harmonic distortion, especially at 50% power (90¬∞ phase angle)<ul>
<li>Harmonics are regulated by CEI 61000-3-2 (Class A devices)</li>
<li>H3 (3rd harmonic) is the most significant, exceeds limits at 50% dimming with ~1700W nominal load</li>
<li>H15 (15th harmonic) first to exceed limits at ~760W nominal load (but less significant than H3)</li>
<li>Maximum compliant load: ~800W without mitigation</li>
<li>Maximum significant load: ~1700W</li>
</ul>
</li>
<li>‚ö†Ô∏è <b>Mitigation may be required</b>: May need RC snubbers, proper wiring, load management, or limiter settings</li>
</ul>
<p><b>MycilaDimmer Implementation:</b></p>
<ul>
<li>All three implementations (ThyristorDimmer, PWMDimmer, DFRobotDimmer) use phase control</li>
<li>ThyristorDimmer: Direct TRIAC/Random SSR control with zero-cross detection</li>
<li>PWMDimmer: Generates PWM signal for converter for voltage regulators (LSA, LCTC) which perform internal phase control</li>
<li>DFRobotDimmer: Outputs 0-10V analog signal to voltage regulators (LSA, LCTC) which perform internal phase control</li>
</ul>
<h3>Burst Fire on Full Period</h3>
<p><b>How it works:</b> Rapidly switches complete AC cycles on/off (20ms periods for 50Hz). For example, to achieve 50% power, alternates full power for 20ms, then turns off for 20ms, and so on.</p>
<p><img src="https://mathieu.carbou.me/MycilaDimmer/assets/img/measurements/burst_fire_20ms.jpeg" alt="" class="inline"/></p>
<p><b>Advantages:</b></p>
<ul>
<li>‚úÖ <b>No Harmonics</b>: Preserves complete sine waves, generates minimal harmonic distortion</li>
<li>‚úÖ <b>Simple Implementation</b>: Basic on/off switching logic</li>
<li>‚úÖ <b>Compatible with many common SSRs</b> (Zero-Cross / Sync ones): Can use simpler, cheaper SSRs</li>
</ul>
<p><b>Limitations:</b></p>
<ul>
<li>‚ùå <b>Flickering</b>: Visible light can flicker and voltage fluctuations can affect nearby devices<ul>
<li>Caused by sudden high current draw creating voltage drops</li>
<li>Can impact micro-inverters and other sensitive electronics</li>
</ul>
</li>
<li>‚ùå <b>Slow Response</b>: Limited precision due to coarse time slots<ul>
<li>Example: 50 slots in 1-second window for 50Hz = 60W resolution for 3000W load</li>
</ul>
</li>
<li>‚ùå <b>Heat Dissipation</b>: Rapid switching generates more heat in SSR</li>
<li>‚ùå <b>Poor Accuracy</b>: Cannot achieve watt-level control precision</li>
<li>‚ùå <b>Delayed Corrections</b>: By the time adjustment is applied, conditions may have changed</li>
</ul>
<h3>Burst Fire on Semi-Period</h3>
<p><b>How it works:</b> Switches at semi-period level (every 10ms for 50Hz) to double the control slots and improve response time. For example, to achieve 50% power, alternates full power and no power for 20ms, and 10ms, to avoid creating DC components.</p>
<p><img src="https://mathieu.carbou.me/MycilaDimmer/assets/img/measurements/burst_fire_10ms.jpeg" alt="" class="inline"/></p>
<p><b>Advantages:</b></p>
<ul>
<li>‚úÖ <b>Better Resolution</b>: Twice as many control slots compared to full-period burst fire</li>
<li>‚úÖ <b>Faster Response</b>: 2x quicker than full-period burst fire</li>
</ul>
<p><b>Limitations:</b></p>
<ul>
<li>‚ùå <b>All Full-Period Limitations</b>: Still suffers from flickering, heat, and inaccuracy but to a lesser extent</li>
<li>‚ùå <b>DC Component</b>: Critical regulatory violation in some countries<ul>
<li>Can create dangerous DC components on AC grid (current asymmetry drawn only one side of the waveform for a short time)</li>
<li>Can unbalance grid network by drawing current asymmetrically if not properly balanced</li>
<li><b>Can violate electrical regulation</b> - this method cannot be used in some countries where regulations forbid DC components on AC grids</li>
</ul>
</li>
</ul>
<h3>Stochastic Burst Fire (Coming Soon)</h3>
<p><b>How it works:</b> Probabilistic switching at each zero-cross. At each AC cycle, generates a random number (0-100) and compares it to the desired power level percentage. If the random number is lower, the full wave is allowed through; otherwise, it's blocked.</p>
<p><b>Advantages:</b></p>
<ul>
<li>‚úÖ <b>No DC Component</b>: Always switches at zero-cross on full waves, maintains grid balance</li>
<li>‚úÖ <b>Eliminates Periodic Flickering</b>: Random distribution prevents visible periodic patterns</li>
<li>‚úÖ <b>Minimal EMF Interference</b>: Zero-cross switching reduces electromagnetic interference</li>
<li>‚úÖ <b>Multi-Channel Safe</b>: Random switching prevents simultaneous current spikes across channels</li>
<li>‚úÖ <b>Even Distribution</b>: Over time, produces statistically accurate power output</li>
<li>‚úÖ <b>No Harmonics</b>: Preserves complete sine waves like traditional burst fire</li>
</ul>
<p><b>Limitations:</b></p>
<ul>
<li>‚ö†Ô∏è <b>Less Precise</b>: Statistical accuracy over time, not instant watt-level precision</li>
<li>‚ö†Ô∏è <b>Requires More Cycles</b>: Needs multiple AC cycles to reach target power level</li>
<li>‚ö†Ô∏è <b>Not for Fast-Response Systems</b>: Better suited for thermal/heating applications with slower dynamics</li>
</ul>
<p><b>Use Cases:</b></p>
<ul>
<li>Multi-channel heating systems</li>
<li>Temperature control with PID regulation</li>
<li>Applications where eliminating flicker is more important than instant precision</li>
<li>Systems sensitive to EMF interference</li>
</ul>
<h2>Recommendations for Harmonic Mitigation (Phase Control)</h2>
<p>When using phase control, harmonics can be reduced or partially mitigated through several approaches. Examples (but not limited to):</p>
<ol type="1">
<li><b>Power Limiter</b>: Limit dimmer (in example to 40% of nominal load)</li>
<li><b>Reduced Load</b>: Use lower wattage resistance (e.g., 1000W @ 53Œ© instead of 3000W @ 18Œ©)</li>
<li><b>Proper Wiring</b>: Minimize cable length, use appropriate wire gauge</li>
<li><b>Strategic Placement</b>: Position router close to grid entry/exit point</li>
<li><b>Stepped Loads</b>: Use multiple resistances with relays (e.g., 3x 800W elements)</li>
<li><b>RC Snubbers</b>: 100Œ© 100nF snubbers can help with sensitive equipment</li>
</ol>
<h2>Current MycilaDimmer Support</h2>
<p><b>Currently Supported (Phase Control):</b></p>
<ul>
<li>‚úÖ ThyristorDimmer - TRIAC/Random SSR with zero-cross detection</li>
<li>‚úÖ PWMDimmer - PWM output for voltage regulators (LSA, LCTC)</li>
<li>‚úÖ DFRobotDimmer - I2C DAC for voltage regulators (LSA, LCTC)</li>
</ul>
<p><b>Coming Soon:</b></p>
<ul>
<li>‚úÖ BurstFireDimmer - Stochastic burst fire for common SSR (Zero-Cross / Sync ones) and TRIAC / Random SSR with zero-cross detection</li>
</ul>
<h2>Choosing the Right Method</h2>
<p><b>For Solar Routers &amp; High-Precision Applications:</b></p>
<ul>
<li>Use <b>Phase Control</b> with appropriate harmonic mitigation</li>
<li>Provides best accuracy and response time</li>
</ul>
<p><b>For Simple On/Off Control:</b></p>
<ul>
<li>Consider <b>normal SSR</b> (Zero-Cross / Sync ones) with simple relay control</li>
<li>Suitable when precise dimming is not required</li>
<li>No harmonics, but no variable power control</li>
</ul>
<h1>References and Further Reading</h1>
<p><b>Harmonics</b></p>
<ul>
<li><a href="http://crochet.david.online.fr/bep/copie%20serveur/Normes/cei%2061000-3-2.pdf">CEI 61000-3-2 Harmonic Standards</a></li>
<li><a href="https://www.thierry-lequeu.fr/data/TRIAC.pdf">Etude des harmoniques du courant de ligne</a> (Thierry Lequeu)</li>
<li><a href="https://fr.electrical-installation.org/frwiki/D√©tection_et_att√©nuation_des_harmoniques">D√©tection et att√©nuation des harmoniques</a> (Schneider Electric)</li>
<li><a href="https://forum-photovoltaique.fr/viewtopic.php?t=60521">Router via TRIAC et "Pollution" du r√©seau</a> (Forum photovolta√Øque)</li>
<li><a href="https://www.salicru.com/files/pagina/72/278/jn004a01_whitepaper-armonics_%281%29.pdf">HARMONICS: CAUSES, EFFECTS AND MINIMIZATION</a> (Ramon Pinyol, R&amp;D Product Leader SALICRU)</li>
<li><a href="http://archives.univ-biskra.dz/bitstream/123456789/21913/1/BELHADJ%20KHEIRA%20ET%20BOUZIR%20NESSRINE.pdf">HARMONIQUES ET DEPOLLUTION DU RESEAU ELECTRIQUE</a> (BELHADJ KHEIRA ET BOUZIR NESSRINE)</li>
<li><a href="https://theses.hal.science/tel-00441877/document">Impact de la pollution harmonique sur les mateÃÅriels de reÃÅseau</a> (Wilfried Frelin)</li>
</ul>
<p><b>TRIAC and Thyristors</b></p>
<ul>
<li><a href="https://www.thierry-lequeu.fr/data/AN437.pdf">NEW TRIACS: IS THE SNUBBER CIRCUIT NECESSARY?</a> (Thierry Lequeu)</li>
<li><a href="https://emrecmic.wordpress.com/2017/02/07/le-triac/">Le triac</a></li>
<li><a href="http://philippe.demerliac.free.fr/RichardK/Graduateur.pdf">Le gradateur</a> (Richard KOWAL)</li>
<li><a href="https://www.luisllamas.es/en/arduino-solid-state-relay-ssr/">Switching Loads with Arduino and Solid State Relay</a></li>
</ul>
<p><b>Technical docs and algorithms</b></p>
<ul>
<li><a href="https://docs.openenergymonitor.org/pv-diversion/">Learn: PV Diversion</a></li>
<li><a href="https://tsltd.github.io">Optimized Random Integral Wave AC Control Algorithm for AC heaters</a></li>
<li><a href="https://www.renesas.com/en/document/apn/1164-cycle-stealing-control">Cycle Stealing Control</a> (Vladimir Veljkovic)</li>
</ul>
<p><b>Solar Router using this library:</b></p>
<ul>
<li><a href="https://yasolr.carbou.me/overview">YaSolR Overview - Detailed Analysis</a></li>
</ul>
<h1>API Reference</h1>
<p><b>Doxygen documentation</b> is available <a href="https://mathieu.carbou.me/MycilaDimmer/api/index.html">here</a>.</p>
<h2>Common API (All Dimmer Types)</h2>
<div class="fragment"><div class="line"><span class="comment">// Lifecycle</span></div>
<div class="line"><span class="keywordtype">void</span> begin();                          <span class="comment">// Initialize dimmer</span></div>
<div class="line"><span class="keywordtype">void</span> end();                            <span class="comment">// Cleanup and disable</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* type() <span class="keyword">const</span>;              <span class="comment">// Get dimmer type name</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Power Control</span></div>
<div class="line"><span class="keywordtype">void</span> on();                             <span class="comment">// Full power</span></div>
<div class="line"><span class="keywordtype">void</span> off();                            <span class="comment">// Turn off</span></div>
<div class="line"><span class="keywordtype">bool</span> setDutyCycle(<span class="keywordtype">float</span> dutyCycle);    <span class="comment">// Set power (0.0-1.0)</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Status &amp; State</span></div>
<div class="line"><span class="keywordtype">bool</span> isEnabled() <span class="keyword">const</span>;                <span class="comment">// Is configured</span></div>
<div class="line"><span class="keywordtype">bool</span> isOnline() <span class="keyword">const</span>;                 <span class="comment">// Ready for operation (enabled + online)</span></div>
<div class="line"><span class="keywordtype">void</span> setOnline(<span class="keywordtype">bool</span> online);           <span class="comment">// Set online status (grid connection)</span></div>
<div class="line"><span class="keywordtype">bool</span> isOn() <span class="keyword">const</span>;                     <span class="comment">// Currently active (online + duty &gt; 0)</span></div>
<div class="line"><span class="keywordtype">bool</span> isOff() <span class="keyword">const</span>;                    <span class="comment">// Currently inactive</span></div>
<div class="line"><span class="keywordtype">bool</span> isOnAtFullPower() <span class="keyword">const</span>;          <span class="comment">// Check if at max power</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Calibration &amp; Remapping</span></div>
<div class="line"><span class="keywordtype">void</span> setDutyCycleMin(<span class="keywordtype">float</span> min);       <span class="comment">// Remap 0% point (hardware calibration)</span></div>
<div class="line"><span class="keywordtype">void</span> setDutyCycleMax(<span class="keywordtype">float</span> max);       <span class="comment">// Remap 100% point</span></div>
<div class="line"><span class="keywordtype">void</span> setDutyCycleLimit(<span class="keywordtype">float</span> limit);   <span class="comment">// Clamp max allowed power</span></div>
<div class="line"><span class="keywordtype">float</span> getDutyCycle() <span class="keyword">const</span>;            <span class="comment">// Current power setting</span></div>
<div class="line"><span class="keywordtype">float</span> getDutyCycleMapped() <span class="keyword">const</span>;      <span class="comment">// Get mapped/calibrated duty cycle</span></div>
<div class="line"><span class="keywordtype">float</span> getDutyCycleLimit() <span class="keyword">const</span>;       <span class="comment">// Get current limit</span></div>
<div class="line"><span class="keywordtype">float</span> getDutyCycleMin() <span class="keyword">const</span>;         <span class="comment">// Get current min</span></div>
<div class="line"><span class="keywordtype">float</span> getDutyCycleMax() <span class="keyword">const</span>;         <span class="comment">// Get current max</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Dimming Curve (Power LUT)</span></div>
<div class="line"><span class="keywordtype">void</span> enablePowerLUT(<span class="keywordtype">bool</span> enable, uint16_t semiPeriod = 0); <span class="comment">// Enable/disable perceptual LUT (default: false)</span></div>
<div class="line"><span class="keywordtype">bool</span> isPowerLUTEnabled() <span class="keyword">const</span>;         <span class="comment">// Check if LUT is enabled</span></div>
<div class="line">uint16_t getPowerLUTSemiPeriod() <span class="keyword">const</span>; <span class="comment">// Get LUT semi-period (us)</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Measurements</span></div>
<div class="line"><span class="keywordtype">float</span> getDutyCycleFire() <span class="keyword">const</span>;         <span class="comment">// Actual firing ratio (0-1)</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef MYCILA_JSON_SUPPORT</span></div>
<div class="line"><span class="keywordtype">void</span> toJson(<span class="keyword">const</span> JsonObject&amp; root) <span class="keyword">const</span>; <span class="comment">// Serialize to JSON</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
</div><!-- fragment --><h2>Thyristor Dimmer Specific</h2>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> setPin(gpio_num_t pin);           <span class="comment">// Set output GPIO pin</span></div>
<div class="line"><span class="keywordtype">void</span> setSemiPeriod(uint16_t semiPeriod); <span class="comment">// Set grid semi-period (us)</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> onZeroCross(int16_t delayUntilZero, <span class="keywordtype">void</span>* arg); <span class="comment">// Zero-cross callback</span></div>
</div><!-- fragment --><h2>PWM Dimmer Specific</h2>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> setPin(gpio_num_t pin);           <span class="comment">// Set output GPIO pin</span></div>
<div class="line"><span class="keywordtype">void</span> setFrequency(uint32_t frequency); <span class="comment">// Set PWM frequency (default: 1000 Hz)</span></div>
<div class="line"><span class="keywordtype">void</span> setResolution(uint8_t resolution); <span class="comment">// Set PWM resolution (default: 12-bit)</span></div>
</div><!-- fragment --><h2>DFRobot DAC Dimmer Specific</h2>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> setWire(TwoWire&amp; wire);           <span class="comment">// Set I2C bus (default: Wire)</span></div>
<div class="line"><span class="keywordtype">void</span> setSKU(SKU sku);                  <span class="comment">// Set module SKU (DFR0971/1071/1073)</span></div>
<div class="line"><span class="keywordtype">void</span> setOutput(Output output);         <span class="comment">// Set voltage range (0-5V or 0-10V)</span></div>
<div class="line"><span class="keywordtype">void</span> setDeviceAddress(uint8_t addr);   <span class="comment">// Set I2C address (default: 0x58)</span></div>
<div class="line"><span class="keywordtype">void</span> setChannel(uint8_t channel);      <span class="comment">// Set DAC channel (0 or 1 for dual-channel)</span></div>
</div><!-- fragment --><h2>Advanced Features</h2>
<div class="fragment"><div class="line"><span class="comment">// Duty Cycle Remapping (Hardware Calibration)</span></div>
<div class="line">dimmer.<a class="code hl_function" href="class_mycila_1_1_dimmer.html#a65e890fe02705d74cb3fb41387d843dc">setDutyCycleMin</a>(0.1);  <span class="comment">// 0% now maps to 10%</span></div>
<div class="line">dimmer.<a class="code hl_function" href="class_mycila_1_1_dimmer.html#abe79bb19232cdede06774f88274672a6">setDutyCycleMax</a>(0.9);  <span class="comment">// 100% now maps to 90%</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Safety Limiting</span></div>
<div class="line">dimmer.<a class="code hl_function" href="class_mycila_1_1_dimmer.html#af83b436ec8799d705dbf22265225beaf">setDutyCycleLimit</a>(0.8); <span class="comment">// Never exceed 80% power</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Power LUT - Selectable Dimming Curve</span></div>
<div class="line"><span class="comment">// Choose between LINEAR or POWER LUT dimming at runtime!</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// LINEAR MODE (default, disabled):</span></div>
<div class="line"><span class="comment">//   - Direct phase angle control</span></div>
<div class="line"><span class="comment">//   - 50% duty cycle = 50% phase delay</span></div>
<div class="line"><span class="comment">//   - Non-linear relationship between duty cycle and actual power output</span></div>
<div class="line"><span class="comment">//   - Use when you need direct phase control or working with non-resistive loads</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// POWER LUT MODE (enabled):</span></div>
<div class="line"><span class="comment">//   - Non-linear curve that matches real power output of resistive loads</span></div>
<div class="line"><span class="comment">//   - 50% duty cycle ‚âà 50% actual power consumption</span></div>
<div class="line"><span class="comment">//   - Also provides more natural dimming that matches human brightness perception</span></div>
<div class="line"><span class="comment">//   - Best for resistive loads (heating elements, incandescent bulbs) where</span></div>
<div class="line"><span class="comment">//     you want predictable power control</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line">dimmer.<a class="code hl_function" href="class_mycila_1_1_dimmer.html#ab6e2373fd4450073598d09778bc1a4ce">enablePowerLUT</a>(<span class="keyword">true</span>, 10000);   <span class="comment">// Enable Power LUT mode (semi-period: 10000us for 50Hz, 8333us for 60Hz)</span></div>
<div class="line">dimmer.<a class="code hl_function" href="class_mycila_1_1_dimmer.html#ab6e2373fd4450073598d09778bc1a4ce">enablePowerLUT</a>(<span class="keyword">false</span>);         <span class="comment">// Switch to linear phase angle mode</span></div>
<div class="line"><span class="keywordtype">bool</span> isUsing = dimmer.<a class="code hl_function" href="class_mycila_1_1_dimmer.html#a838a358149e8ee1dc7a101d64b45e0ac">isPowerLUTEnabled</a>(); <span class="comment">// Check current mode</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Online Status Control</span></div>
<div class="line">dimmer.<a class="code hl_function" href="class_mycila_1_1_dimmer.html#a7dfc096d101bd15b5948d1e398fdc236">setOnline</a>(<span class="keyword">false</span>); <span class="comment">// Temporarily disable dimmer (e.g., when grid disconnected)</span></div>
<div class="line">dimmer.<a class="code hl_function" href="class_mycila_1_1_dimmer.html#a7dfc096d101bd15b5948d1e398fdc236">setOnline</a>(<span class="keyword">true</span>);  <span class="comment">// Re-enable dimmer</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Telemetry (with MYCILA_JSON_SUPPORT)</span></div>
<div class="line"><span class="preprocessor">#ifdef MYCILA_JSON_SUPPORT</span></div>
<div class="line">JsonDocument doc;</div>
<div class="line">dimmer.toJson(doc.to&lt;JsonObject&gt;());</div>
<div class="line">serializeJson(doc, Serial);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="ttc" id="aclass_mycila_1_1_dimmer_html_a65e890fe02705d74cb3fb41387d843dc"><div class="ttname"><a href="class_mycila_1_1_dimmer.html#a65e890fe02705d74cb3fb41387d843dc">Mycila::Dimmer::setDutyCycleMin</a></div><div class="ttdeci">void setDutyCycleMin(float min)</div><div class="ttdoc">Duty remapping (equivalent to Shelly Dimmer remapping feature). Useful to calibrate the dimmer when u...</div><div class="ttdef"><b>Definition</b> <a href="_mycila_dimmer_8h_source.html#l00049">MycilaDimmer.h:49</a></div></div>
<div class="ttc" id="aclass_mycila_1_1_dimmer_html_a7dfc096d101bd15b5948d1e398fdc236"><div class="ttname"><a href="class_mycila_1_1_dimmer.html#a7dfc096d101bd15b5948d1e398fdc236">Mycila::Dimmer::setOnline</a></div><div class="ttdeci">void setOnline(bool online)</div><div class="ttdoc">Set the online status of the dimmer.</div><div class="ttdef"><b>Definition</b> <a href="_mycila_dimmer_8h_source.html#l00143">MycilaDimmer.h:143</a></div></div>
<div class="ttc" id="aclass_mycila_1_1_dimmer_html_a838a358149e8ee1dc7a101d64b45e0ac"><div class="ttname"><a href="class_mycila_1_1_dimmer.html#a838a358149e8ee1dc7a101d64b45e0ac">Mycila::Dimmer::isPowerLUTEnabled</a></div><div class="ttdeci">bool isPowerLUTEnabled() const</div><div class="ttdoc">Check if the power LUT is enabled.</div><div class="ttdef"><b>Definition</b> <a href="_mycila_dimmer_8h_source.html#l00118">MycilaDimmer.h:118</a></div></div>
<div class="ttc" id="aclass_mycila_1_1_dimmer_html_ab6e2373fd4450073598d09778bc1a4ce"><div class="ttname"><a href="class_mycila_1_1_dimmer.html#ab6e2373fd4450073598d09778bc1a4ce">Mycila::Dimmer::enablePowerLUT</a></div><div class="ttdeci">void enablePowerLUT(bool enable, uint16_t semiPeriod=0)</div><div class="ttdoc">Enable or disable the use of power LUT for dimmer curve The power LUT provides a non-linear dimming c...</div><div class="ttdef"><b>Definition</b> <a href="_mycila_dimmer_8h_source.html#l00096">MycilaDimmer.h:96</a></div></div>
<div class="ttc" id="aclass_mycila_1_1_dimmer_html_abe79bb19232cdede06774f88274672a6"><div class="ttname"><a href="class_mycila_1_1_dimmer.html#abe79bb19232cdede06774f88274672a6">Mycila::Dimmer::setDutyCycleMax</a></div><div class="ttdeci">void setDutyCycleMax(float max)</div><div class="ttdoc">Duty remapping (equivalent to Shelly Dimmer remapping feature). Useful to calibrate the dimmer when u...</div><div class="ttdef"><b>Definition</b> <a href="_mycila_dimmer_8h_source.html#l00060">MycilaDimmer.h:60</a></div></div>
<div class="ttc" id="aclass_mycila_1_1_dimmer_html_af83b436ec8799d705dbf22265225beaf"><div class="ttname"><a href="class_mycila_1_1_dimmer.html#af83b436ec8799d705dbf22265225beaf">Mycila::Dimmer::setDutyCycleLimit</a></div><div class="ttdeci">void setDutyCycleLimit(float limit)</div><div class="ttdoc">Set the power duty cycle limit of the dimmer. The duty cycle will be clamped to this limit.</div><div class="ttdef"><b>Definition</b> <a href="_mycila_dimmer_8h_source.html#l00037">MycilaDimmer.h:37</a></div></div>
</div><!-- fragment --><h1>Configuration</h1>
<h2>Build Flags</h2>
<p>For <b>Thyristor Dimmer</b> (IRAM safety):</p>
<div class="fragment"><div class="line">build_flags =</div>
<div class="line">  -D CONFIG_ARDUINO_ISR_IRAM=1</div>
<div class="line">  -D CONFIG_GPTIMER_ISR_HANDLER_IN_IRAM=1</div>
<div class="line">  -D CONFIG_GPTIMER_CTRL_FUNC_IN_IRAM=1</div>
<div class="line">  -D CONFIG_GPTIMER_ISR_IRAM_SAFE=1</div>
<div class="line">  -D CONFIG_GPIO_CTRL_FUNC_IN_IRAM=1</div>
<div class="line"> </div>
<div class="line">lib_deps =</div>
<div class="line">  mathieucarbou/MycilaPulseAnalyzer</div>
</div><!-- fragment --><p>For <b>JSON Support</b>:</p>
<div class="fragment"><div class="line">build_flags =</div>
<div class="line">  -D MYCILA_JSON_SUPPORT</div>
<div class="line"> </div>
<div class="line">lib_deps =</div>
<div class="line">  bblanchon/ArduinoJson</div>
</div><!-- fragment --><h1>Examples</h1>
<p>The library includes comprehensive examples:</p>
<ul>
<li><b><a href="https://github.com/mathieucarbou/MycilaDimmer/tree/main/examples/DAC/">DAC Example</a></b> - DFRobot DAC module control</li>
<li><b><a href="https://github.com/mathieucarbou/MycilaDimmer/tree/main/examples/Json/">JSON Example</a></b> - Telemetry and JSON integration</li>
<li><b><a href="https://github.com/mathieucarbou/MycilaDimmer/tree/main/examples/PWM/">PWM Example</a></b> - Basic PWM dimming</li>
<li><b><a href="https://github.com/mathieucarbou/MycilaDimmer/tree/main/examples/Thyristor/">Thyristor Example</a></b> - TRIAC control with zero-cross detection</li>
<li><b><a href="https://github.com/mathieucarbou/MycilaDimmer/tree/main/examples/ThyristorAutoFrequency/">ThyristorAutoFrequency Example</a></b> - Automatic detection of frequency and semi-period</li>
<li><b><a href="https://github.com/mathieucarbou/MycilaDimmer/tree/main/examples/ThyristorWithFS/">ThyristorWithFS Example</a></b> - File system integration</li>
</ul>
<h1>Build Configuration</h1>
<h2>PlatformIO Configuration</h2>
<div class="fragment"><div class="line">[platformio]</div>
<div class="line">lib_dir = .</div>
<div class="line">src_dir = examples/Thyristor  ; or DAC, PWM, etc.</div>
<div class="line"> </div>
<div class="line">[env]</div>
<div class="line">framework = arduino</div>
<div class="line">board = esp32dev</div>
<div class="line">build_flags =</div>
<div class="line">  -D CONFIG_ARDUHAL_LOG_COLORS</div>
<div class="line">  -D CORE_DEBUG_LEVEL=ARDUHAL_LOG_LEVEL_DEBUG</div>
<div class="line">  -Wall -Wextra</div>
<div class="line">  ; ThyristorDimmer specific flags</div>
<div class="line">  -D CONFIG_ARDUINO_ISR_IRAM=1</div>
<div class="line">  -D CONFIG_GPTIMER_ISR_HANDLER_IN_IRAM=1</div>
<div class="line">  -D CONFIG_GPTIMER_CTRL_FUNC_IN_IRAM=1</div>
<div class="line">  -D CONFIG_GPTIMER_ISR_IRAM_SAFE=1</div>
<div class="line">  -D CONFIG_GPIO_CTRL_FUNC_IN_IRAM=1</div>
<div class="line">lib_deps =</div>
<div class="line">  bblanchon/ArduinoJson</div>
<div class="line">  mathieucarbou/MycilaPulseAnalyzer</div>
</div><!-- fragment --><h2>Dependencies</h2>
<ul>
<li><b>ESP32 Arduino Core</b> (any recent version)</li>
<li><b><a href="https://github.com/bblanchon/ArduinoJson">ArduinoJson</a></b> (optional, for JSON support)</li>
<li><b><a href="https://github.com/mathieucarbou/MycilaPulseAnalyzer">MycilaPulseAnalyzer</a></b> (optional, for zero-cross examples)</li>
</ul>
<h1>Troubleshooting</h1>
<h2>Common Issues</h2>
<p><b>Thyristor Dimmer Not Working</b></p>
<ul>
<li>Ensure IRAM build flags are set</li>
<li>Check semi-period is configured (<span class="tt">setSemiPeriod()</span>)</li>
<li>Verify zero-cross signal is connected and working</li>
</ul>
<p><b>PWM Output Not Visible</b></p>
<ul>
<li>Check GPIO pin configuration</li>
<li>Verify PWM frequency and resolution settings</li>
<li>Use oscilloscope or LED to test output</li>
</ul>
<p><b>DFRobot Module Not Responding</b></p>
<ul>
<li>Verify I2C wiring (SDA, SCL, power, ground)</li>
<li>Check device address with I2C scanner</li>
<li>Ensure correct SKU is configured</li>
</ul>
<h1>Contributing</h1>
<ol type="1">
<li>Fork the repository</li>
<li>Create a feature branch (<span class="tt">git checkout -b feature/amazing-feature</span>)</li>
<li>Commit your changes (&lsquo;git commit -m 'Add amazing feature&rsquo;<span class="tt">)</span></li>
<li><span class="tt">Push to the branch (</span>git push origin feature/amazing-feature`)</li>
<li>Open a Pull Request</li>
</ol>
<h2>Development Setup</h2>
<div class="fragment"><div class="line">git clone https://github.com/mathieucarbou/MycilaDimmer.git</div>
<div class="line">cd MycilaDimmer</div>
<div class="line">pio run</div>
</div><!-- fragment --><h1>License</h1>
<p>This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.</p>
<h1>Disclaimer</h1>
<p><em>This website is provided for informational purposes only. By accessing this site and using the information contained herein, you accept the terms set forth in this disclaimer.</em></p>
<ul>
<li><em><b>Accuracy of Information</b>: We strive to provide accurate and up-to-date information on this site, but we cannot guarantee the completeness or accuracy of this information. The information provided is subject to change without notice.</em></li>
<li><em><b>Use of Information</b>: Use of the information provided on this site is at your own risk. *We decline all responsibility for the consequences arising from the use of this information. It is recommended that you consult a competent professional for advice specific to your situation.</em></li>
<li><em><b>External Links</b>: This site may contain links to external websites which are provided for your reference and convenience. We have no control over the content of these external sites and we accept no responsibility for their content and their use.</em></li>
<li><em><b>Limitation of Liability</b>: To the fullest extent permitted by applicable law, we disclaim all liability for any direct, indirect, incidental, consequential or special damages arising out of the use of, or inability to use, this website, even if we have been advised of the possibility of such damage.</em></li>
</ul>
<p><em>By using this site, you agree to hold harmless the owners, administrators and authors of this site from any claims arising from your use of this website. <b>If you do not agree to these terms, please do not use this site.</b></em></p>
<hr  />
<p><b>Author</b>: <a href="https://github.com/mathieucarbou">Mathieu Carbou</a> <br  />
 <b>Used in</b>: <a href="https://yasolr.carbou.me">YaSolR Solar Router</a> </p>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"></a>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
